<script>
  async function pesquisar() {
    const termo = document.getElementById("busca").value.toLowerCase();
    const resultados = document.getElementById("resultados");
    resultados.innerHTML = "Carregando...";

    const sheetID = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQIjGlGfirq-urRkYQKubjuXjtpao-5xGuoRxm1eb3XB1s3OrDAINdf8hmHlJkLSg/pubhtml";
    const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json`;

    try {
      const response = await fetch(url);
      const text = await response.text();
      const json = JSON.parse(text.substr(47).slice(0, -2));
      const rows = json.table.rows;

      const encontrados = rows.filter(row => {
        const nome = row.c[0]?.v?.toLowerCase() || "";
        return nome.includes(termo);
      });

      if (encontrados.length === 0) {
        resultados.innerHTML = "<p>Nenhum resultado encontrado.</p>";
        return;
      }

      resultados.innerHTML = "";
      encontrados.forEach(row => {
        const nome = row.c[0]?.v || "Sem nome";
        const local = row.c[1]?.v || "Desconhecido";
        const ano = row.c[2]?.v || "Sem data";
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `<strong>${nome}</strong><br>Local: ${local}<br>Ano: ${ano}`;
        resultados.appendChild(div);
      });

    } catch (err) {
      resultados.innerHTML = "<p>Erro ao carregar os dados.</p>";
      console.error(err);
    }
  }
</script>
